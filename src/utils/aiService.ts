
import { GameState, Suspect, Evidence } from '../hooks/useGameState';

// æ¨¡æ‹ŸAIè¯·æ±‚å‡½æ•° - åœ¨å®é™…åº”ç”¨ä¸­æ›¿æ¢ä¸ºçœŸå®APIè°ƒç”¨
export const mockLLMRequest = async (prompt: string): Promise<string> => {
  // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
  await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
  
  // æ ¹æ®æç¤ºè¯ç±»å‹è¿”å›ä¸åŒçš„æ¨¡æ‹Ÿå“åº”
  if (prompt.includes('æ¡ˆä»¶ç”Ÿæˆ')) {
    return JSON.stringify({
      victim: 'é™ˆå›½æ ‹',
      description: 'äº¿ä¸‡å¯Œç¿é™ˆå›½æ ‹è¢«å‘ç°æ­»äºç§äººä¹¦æˆ¿ï¼Œå¿ƒè„è¢«æ‹†ä¿¡åˆ€åˆºç©¿',
      suspects: [
        {
          id: 'suspect_1',
          name: 'å¼ ä¸½ä¸½',
          occupation: 'æ­»è€…å¦»å­',
          relationship: 'å¤«å¦»å…³ç³»',
          motive: 'å‘ç°ä¸ˆå¤«å‡ºè½¨å¹¶å‡†å¤‡ç¦»å©šï¼Œæ‹…å¿ƒå¤±å»å·¨é¢è´¢äº§ç»§æ‰¿æƒ',
          alibi: 'å£°ç§°æ¡ˆå‘æ—¶åœ¨æ¥¼ä¸Šå§å®¤ä¼‘æ¯'
        },
        {
          id: 'suspect_2', 
          name: 'ç‹æ˜è¿œ',
          occupation: 'å•†ä¸šä¼™ä¼´',
          relationship: 'åˆä½œä¼™ä¼´',
          motive: 'å› ä¸ºåäº¿å…ƒé¡¹ç›®åˆ†æ­§ï¼Œæ­»è€…å¨èƒè¦æ’¤é”€åˆä½œåè®®',
          alibi: 'å£°ç§°åœ¨å…¬å¸åŠ ç­åˆ°æ·±å¤œ'
        },
        {
          id: 'suspect_3',
          name: 'æå¿—å¼º', 
          occupation: 'ç§äººåŒ»ç”Ÿ',
          relationship: 'åŒ»æ‚£å…³ç³»',
          motive: 'æ›¾ç»è¯¯è¯Šå¯¼è‡´æ­»è€…æ¯äº²å»ä¸–ï¼Œä¸€ç›´è¢«æ­»è€…å¨èƒè¦æ›å…‰',
          alibi: 'å£°ç§°åœ¨åŒ»é™¢å€¼å¤œç­'
        }
      ],
      evidence: [
        {
          id: 'evidence_1',
          name: 'è¡€è¿¹æ‹†ä¿¡åˆ€',
          description: 'å‡¶å™¨ï¼Œåˆ€æŸ„ä¸Šå‘ç°æŒ‡çº¹ï¼Œä½†å·²è¢«äººä¸ºæ“¦æ‹­è¿‡',
          location: 'æ­»è€…èƒ¸å‰'
        },
        {
          id: 'evidence_2',
          name: 'ç ´ç¢èŠ±ç“¶',
          description: 'æ˜‚è´µçš„å¤è‘£èŠ±ç“¶ç¢ç‰‡ï¼Œç–‘ä¼¼ææ–—æ—¶è¢«æ‰“ç¢',
          location: 'ä¹¦æˆ¿é˜³å°'
        }
      ],
      solution: 'suspect_1'
    });
  }
  
  if (prompt.includes('å®¡é—®')) {
    const responses = [
      'æˆ‘å½“æ—¶åœ¨æ¥¼ä¸Šä¼‘æ¯ï¼Œä»€ä¹ˆéƒ½æ²¡å¬åˆ°...',
      'è¿™ä¸ªé—®é¢˜æˆ‘ä¸æƒ³å›ç­”ï¼Œè¯·é—®å…¶ä»–çš„å§ã€‚',
      'æˆ‘å’Œæ­»è€…çš„å…³ç³»å¾ˆå¤æ‚ï¼Œä½†æˆ‘ç»å¯¹æ²¡æœ‰æ€ä»–ï¼',
      'ä½ è¿™æ˜¯åœ¨æ€€ç–‘æˆ‘å—ï¼Ÿæˆ‘æœ‰ä¸åœ¨åœºè¯æ˜ï¼',
      'é‚£å¤©æ™šä¸Šç¡®å®æœ‰äº›å¼‚å¸¸ï¼Œä½†æˆ‘ä¿è¯ä¸æ˜¯æˆ‘åšçš„...'
    ];
    return responses[Math.floor(Math.random() * responses.length)];
  }
  
  if (prompt.includes('çŠ¯ç½ªç°åœº')) {
    return `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                ä¹¦æˆ¿å¹³é¢å›¾                                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                               â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘    â”‚              ä¹¦æˆ¿ä¸»åŒºåŸŸ              â”‚    â”‚           é˜³å°åŒºåŸŸ           â”‚ â•‘
â•‘    â”‚                                     â”‚    â”‚                             â”‚ â•‘
â•‘    â”‚  â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚    â”‚      â˜  ç ´ç¢èŠ±ç“¶             â”‚ â•‘
â•‘    â”‚  â”‚ä¹¦æ¶ â”‚     â”‚  åŠå…¬æ¡Œ  â”‚           â”‚    â”‚         ç¢ç‰‡                â”‚ â•‘
â•‘    â”‚  â”‚     â”‚     â”‚    ğŸ’»   â”‚           â”‚    â”‚                             â”‚ â•‘
â•‘    â”‚  â””â”€â”€â”€â”€â”€â”˜     â”‚  ğŸ—‚ï¸ğŸ“  â”‚           â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”                   â”‚ â•‘
â•‘    â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚    â”‚  â”‚èŠ±å° â”‚                   â”‚ â•‘
â•‘    â”‚                                     â”‚    â”‚  â””â”€â”€â”€â”€â”€â”˜                   â”‚ â•‘
â•‘    â”‚         ğŸ’€ å°¸ä½“ä½ç½®                 â”‚    â”‚                             â”‚ â•‘
â•‘    â”‚        ğŸ”ª æ‹†ä¿¡åˆ€                   â”‚    â”‚                             â”‚ â•‘
â•‘    â”‚       ğŸ©¸ è¡€è¿¹                      â”‚    â”‚                             â”‚ â•‘
â•‘    â”‚                                     â”‚    â”‚                             â”‚ â•‘
â•‘    â”‚  â”Œâ”€â”€â”€â”€â”€â”                           â”‚    â”‚                             â”‚ â•‘
â•‘    â”‚  â”‚æ²™å‘ â”‚                           â”‚    â”‚                             â”‚ â•‘
â•‘    â”‚  â””â”€â”€â”€â”€â”€â”˜                           â”‚    â”‚                             â”‚ â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                               â”‚                                               â•‘
â•‘                               â”‚                                               â•‘
â•‘                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â•‘
â•‘                          â”‚   é—¨å£   â”‚                                         â•‘
â•‘                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â•‘
â•‘                                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç°åœºåˆ†æ:
â€¢ æ­»è€…å€’åœ¨åŠå…¬æ¡Œå‰ï¼Œé¢æœé˜³å°æ–¹å‘
â€¢ æ‹†ä¿¡åˆ€æ’åœ¨èƒ¸å‰ï¼Œè§’åº¦è¡¨æ˜å‡¶æ‰‹èº«é«˜çº¦1.7ç±³
â€¢ é˜³å°èŠ±ç“¶è¢«æ‰“ç¢ï¼Œç–‘ä¼¼ææ–—ç—•è¿¹
â€¢ åŠå…¬æ¡Œä¸Šæ–‡ä»¶æ•£ä¹±ï¼Œä½†ç”µè„‘æœªè¢«è§¦ç¢°
â€¢ é—¨é”å®Œå¥½ï¼Œå†…éƒ¨åé”ï¼Œå‡¶æ‰‹å¯èƒ½ä»é˜³å°é€ƒè„±
`;
  }
  
  return 'æ¨¡æ‹ŸAIå“åº”ï¼šè¯·æ£€æŸ¥æç¤ºè¯å†…å®¹';
};

export const generateCase = async (): Promise<Partial<GameState>> => {
  const prompt = `æ¡ˆä»¶ç”Ÿæˆï¼šåˆ›å»ºä¸€èµ·è°‹æ€æ¡ˆï¼ŒåŒ…å«å—å®³è€…ã€3åå«Œç–‘äººå’Œåˆå§‹è¯æ®`;
  const response = await mockLLMRequest(prompt);
  
  try {
    const caseData = JSON.parse(response);
    return {
      caseId: `MH${new Date().getFullYear().toString().slice(-2)}${Math.random().toString(36).substr(2, 6).toUpperCase()}`,
      caseDescription: caseData.description,
      victim: caseData.victim,
      suspects: caseData.suspects,
      evidence: caseData.evidence,
      solution: caseData.solution
    };
  } catch (error) {
    throw new Error('æ¡ˆä»¶ç”Ÿæˆå¤±è´¥ï¼šAIå“åº”æ ¼å¼é”™è¯¯');
  }
};

export const interrogateSuspect = async (suspect: Suspect, gameState: GameState): Promise<string> => {
  const prompt = `å®¡é—®å«Œç–‘äºº${suspect.name}ï¼Œæ ¹æ®å…¶åŠ¨æœº"${suspect.motive}"ç”Ÿæˆå›ç­”`;
  
  const questions = [
    'æ¡ˆå‘å½“æ™šä½ åœ¨å“ªé‡Œï¼Ÿ',
    'ä½ å’Œæ­»è€…çš„å…³ç³»å¦‚ä½•ï¼Ÿ',
    'ä½ æœ‰ä»€ä¹ˆè¦éšç’çš„å—ï¼Ÿ',
    'æœ‰äººèƒ½è¯æ˜ä½ çš„ä¸åœ¨åœºè¯æ˜å—ï¼Ÿ'
  ];
  
  let interrogationLog = '';
  
  for (const question of questions) {
    const answer = await mockLLMRequest(prompt + question);
    interrogationLog += `\nä¾¦æ¢: ${question}\n${suspect.name}: ${answer}\n`;
  }
  
  return interrogationLog;
};

export const generateCrimeScene = async (gameState: GameState): Promise<string> => {
  const prompt = `æ ¹æ®æ¡ˆä»¶"${gameState.caseDescription}"ç”ŸæˆçŠ¯ç½ªç°åœºASCIIå›¾`;
  return await mockLLMRequest(prompt);
};
